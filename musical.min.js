!function(a,b,c){function d(){return!(!a.AudioContext&&!a.webkitAudioContext)}function e(){if(!i){var b=new(a.AudioContext||a.webkitAudioContext);i={ac:b,out:null},f()}return i}function f(){if(i){i.out&&(i.out.disconnect(),i.out=null);var a=i.ac.createDynamicsCompressor();a.ratio=16,a.attack=5e-4,a.connect(i.ac.destination),i.out=a}}function g(){return null!=i.currentStart?i.currentStart:(i.currentStart=i.ac.currentTime+k,setTimeout(function(){i.currentStart=null},0),i.currentStart)}var h=!1,i=null,k=0,l=function(){function a(a){this._timbre=b(a),this._queue=[],this._minQueueTime=1/0,this._maxScheduledTime=0,this._unsortedQueue=!1,this._startSet=[],this._finishSet={},this._cleanupSet=[],this._conflictCount=0,this._callbackSet=[],this._handlers={},this._now=null,d()&&this.silence()}function b(a){a?"string"==typeof a&&(a=y(a,"wave")):a={};var b,c={};for(b in A)A.hasOwnProperty(b)&&(c[b]=a.hasOwnProperty(b)?a[b]:A[b]);return c}function c(a){function c(a){a=a||"",(a||r===q)&&(!a||r.id||r.stems&&r.stems.length?q.voice.hasOwnProperty(a)?(r=q.voice[a],t={}):(r={id:a},q.voice[a]=r,t={}):(delete q.voice[r.id],r.id=a,q.voice[a]=r))}function d(){return q.V?q.V.split(/\s+/)[0]:""}var e,g,h,j,m,p=a.split("\n"),q={voice:{}},r=q,s={},t={};for(g=0;g<p.length;++g)if(h=B.exec(p[g])){switch(h[1]){case"V":r!==q&&c(h[2].split(" ")[0]);break;case"M":f(h[2],r);break;case"L":i(h[2],r);break;case"Q":k(h[2],r);break;case"I":e=/^timbre\s+(.*)$/.exec(h[2]),e&&(r.timbre=b(e))}r.hasOwnProperty(h[1])?r[h[1]]+="\n"+h[2]:r[h[1]]=h[2],"K"==h[1]&&r===q&&(s=n(h[2]),c(d()))}else m={},j=o(p[g],s,t,m),m.voiceid&&c(m.voiceid),j&&j.length&&(r===q&&c(d()),"stems"in r||(r.stems=[]),r.stems.push.apply(r.stems,j));if(q.voice)for(g in q.voice)q.voice[g].stems&&l(q.voice[g].stems);return q}function f(a,b){var c=/^C/.test(a)?1:x(a);c&&(b.unitnote||(b.unitnote=.75>c?1/16:1/8))}function i(a,b){var c=x(a);c&&(b.unitnote=c)}function k(a,b){var c,d=a.split(/\s*=\s*/),e=null,f=null;for(c=0;c<d.length;++c)d[c].indexOf("/")>=0||/^[1-4]$/.test(d[c])?e=e||x(d[c]):f=f||Number(d[c]);e&&(b.unitbeat=e),f&&(b.tempo=f)}function l(a){var b,c,d,e,f,g={};for(c=0;c<a.length;++c){for(b={},d=0;d<a[c].note.length;++d)f=e=a[c].note[d],g.hasOwnProperty(e.pitch)&&(f=g[e.pitch],f.time+=e.time,e.holdover=!0),e.tie&&(b[e.pitch]=f);g=b}}function m(a){var b,c="FCGDAEB",d={};if(!a)return d;if(a>0)for(b=0;a>b&&7>b;++b)d[c.charAt(b)]="^";else for(b=0;b>a&&b>-7;--b)d[c.charAt(6+b)]="_";return d}function n(a){if(!a)return{};var b,c={"c#":7,"f#":6,b:5,e:4,a:3,d:2,g:1,c:0,f:-1,bb:-2,eb:-3,ab:-4,db:-5,gb:-6,cb:-7,"a#m":7,"d#m":6,"g#m":5,"c#m":4,"f#m":3,bm:2,em:1,am:0,dm:-1,gm:-2,cm:-3,fm:-4,bbm:-5,ebm:-6,abm:-7,"g#mix":7,"c#mix":6,"f#mix":5,bmix:4,emix:3,amix:2,dmix:1,gmix:0,cmix:-1,fmix:-2,bbmix:-3,ebmix:-4,abmix:-5,dbmix:-6,gbmix:-7,"d#dor":7,"g#dor":6,"c#dor":5,"f#dor":4,bdor:3,edor:2,ador:1,ddor:0,gdor:-1,cdor:-2,fdor:-3,bbdor:-4,ebdor:-5,abdor:-6,dbdor:-7,"e#phr":7,"a#phr":6,"d#phr":5,"g#phr":4,"c#phr":3,"f#phr":2,bphr:1,ephr:0,aphr:-1,dphr:-2,gphr:-3,cphr:-4,fphr:-5,bbphr:-6,ebphr:-7,"f#lyd":7,blyd:6,elyd:5,alyd:4,dlyd:3,glyd:2,clyd:1,flyd:0,bblyd:-1,eblyd:-2,ablyd:-3,dblyd:-4,gblyd:-5,cblyd:-6,fblyd:-7,"b#loc":7,"e#loc":6,"a#loc":5,"d#loc":4,"g#loc":3,"c#loc":2,"f#loc":1,bloc:0,eloc:-1,aloc:-2,dloc:-3,gloc:-4,cloc:-5,floc:-6,bbloc:-7};a=a.replace(/\s+/g,"").toLowerCase().substr(0,5);var d=a.match(/maj|min|mix|dor|phr|lyd|loc|m/);b=d?"maj"==d?a.substr(0,d.index):"min"==d?a.substr(0,d.index+1):a.substr(0,d.index+d.length):/^[a-g][#b]?/.exec(a)||"";var e=m(c[b]),f=a.substr(b.length).match(/(__|_|=|\^\^|\^)[a-g]/g);if(f)for(j=0;j<f.length;++j){var g=f[j].charAt(f[j].length-1).toUpperCase();"="==f[j].charAt(0)?delete e[g]:e[g]=f[j].substr(0,f[j].length-1)}return e}function o(a,b,c,d){var e,f=a.match(C),g=[],h=null,i=0,j=0;if(!f)return null;for(;i<f.length;)if(/^[\s%!]/.test(f[i]))i++;else if(/^\[V:\S*\]$/.test(f[i]))d.voiceid=f[i].substring(3,f[i].length-1),i++;else if(/</.test(f[i]))j=-f[i++].length;else if(/>/.test(f[i]))j=f[i++].length;else if(/\|/.test(f[i])){for(e in c)c.hasOwnProperty(e)&&delete c[e];i++}else h=q(f,i,b,c),null!==h?null!==h&&(j&&g.length&&(e=j>0?(1-Math.pow(.5,j))*h.stem.time:(Math.pow(.5,-j)-1)*g[g.length-1].time,p(g[g.length-1],e),p(h.stem,-e)),j=0,g.push(h.stem),i=h.index):i++;return g}function p(a,b){var c,d=a.time,e=d+b;for(a.time=e,c=0;c<a.note.length;++c)note=a.note[c],note.time==d&&(note.time=e)}function q(a,b,c,d){var e,f,g,h=[],i="",j=!1,k=null,l=1/0;if(b<a.length&&"."==a[b]&&(j=!0,b++),b<a.length&&"["==a[b]){for(b++;b<a.length;)if(/^[\s%!]/.test(a[b]))b++;else{if(/[A-Ga-g]/.test(a[b]))k={pitch:s(a[b++],c,d),tie:!1},k.frequency=w(k.pitch),h.push(k);else{if(!/[xzXZ]/.test(a[b])){if("."==a[b]){j=!0,b++;continue}break}k=null,b++}b<a.length&&/^(?![\s%!]).*[\d\/]/.test(a[b])?(e=a[b++],f=x(e)):(e="",f=1),k&&(k.duration=e,k.time=f),f&&l>f&&(i=e,l=f),b<a.length&&"-"==a[b]&&(k&&(h[h.length-1].tie=!0),b++)}if("]"!=a[b])return null;b++}else if(b<a.length&&/[A-Ga-g]/.test(a[b]))k={pitch:s(a[b++],c,d),tie:!1,duration:"",time:1},k.frequency=w(k.pitch),h.push(k);else{if(!(b<a.length&&/^[xzXZ]$/.test(a[b])))return null;b++}if(b<a.length&&/^(?![\s%!]).*[\d\/]/.test(a[b]))for(i=a[b++],f=x(i),g=0;g<h.length;++g)h[g].duration=i,h[g].time=f;if(b<a.length&&"-"==a[b])for(b++,g=0;g<h.length;++g)h[g].tie=!0;return{index:b,stem:{note:h,duration:i,staccato:j,time:x(i)}}}function r(a){return a.length>0&&"="==a.charAt(0)?a.substr(1):a}function s(a,b,c){var d,e=/^(\^\^|\^|__|_|=|)([A-Ga-g])(.*)$/.exec(a);return e?(d=e[2].toUpperCase(),e[1].length>0?(c[d]=e[1],r(a)):r(c.hasOwnProperty(d)?c[d]+e[2]+e[3]:b.hasOwnProperty(d)?b[d]+e[2]+e[3]:a)):a}function t(a){return 440*Math.pow(2,(a-69)/12)}function u(a){return Math.round(69+12*Math.log(a/440)/Math.LN2)}function v(a){var b=/^(\^\^|\^|__|_|=|)([A-Ga-g])(,+|'+|)$/.exec(a);if(!b)return null;var c={C:-9,D:-7,E:-5,F:-4,G:-2,A:0,B:2,c:3,d:5,e:7,f:8,g:10,a:12,b:14},d={"^^":2,"^":1,"":0,"=":0,_:-1,__:-2},e=c[b[2]]+d[b[1]]+(/,/.test(b[3])?-12:12)*b[3].length;return e+69}function w(a){return t(v(a))}function x(a){var b,c,d,e=/^(\d*)(?:\/(\d*))?$|^(\/+)$/.exec(a),f=0;if(e){if(e[3])return Math.pow(.5,e[3].length);for(c=e[2]?parseFloat(e[2]):/\//.test(a)?2:1,d=0,b=e[1]?parseFloat(e[1]):1;d+1<e[1].length&&b>c;)d+=1,f=parseFloat(e[1].substring(0,d)),b=parseFloat(e[1].substring(d));return f+b/c}}function y(a,b){function c(){for(;l.length&&/^\s/.test(l[l.length-1]);)l.pop();for(;l.length&&/^\s/.test(l[0]);)l.shift();1==l.length&&(/^".*"$/.test(l[0])||/^'.*'$/.test(l[0]))?g=l[0].substr(1,l[0].length-2):2==l.length&&"url"==l[0]&&/^(.*)$/.test(l[1])?g=l[1].substr(1,l[1].length-2):(h=l.join(""),g=""==h?h:isNaN(h)?h:Number(h)),!k&&m&&b&&l.length&&(e=b),e&&(d[e]=g)}var d={},e=null;if(null==a)return d;if("object"==typeof a){for(e in a)a.hasOwnProperty(e)&&(d[e]=a[e]);return d}a=""+a;var f,g,h,i=a.match(/[-a-zA-Z_][-\w]*|"[^"]*"|'[^']'|\([^()]*\)|\s+|./g),k=!1,l=[],m=!0;for(j=0;j<i.length;++j)f=i[j],k||(!e&&/^[a-zA-Z_-]/.test(f)&&(e=f),":"!=f)?";"!=f?l.push(f):(c(),e=null,l.length=0,k=!1,m=!1):(k=!0,l.length=0);return c(),d}function z(a){function b(a){return/[\s;]/.test(a)?a.indexOf('"')<0?'"'+a+'"':"'"+a+"'":a}var c=[];for(var d in a)a.hasOwnProperty(d)&&c.push(d+":"+b(a[d])+";");return c.join(" ")}a.bufferSecs=3,a.toneLength=10,a.cleanupDelay=.1,a.nowDelay=0,a.prototype.setTimbre=function(a){this._timbre=b(a)},a.prototype.getTimbre=function(){return z(this._timbre)},a.prototype.silence=function(){var a;this._queue.length=0,this._minQueueTime=1/0,this._maxScheduledTime=0,this._startSet.length=0;for(a in this._finishSet)this._finishSet.hasOwnProperty(a)&&this._trigger("noteoff",this._finishSet[a]);for(this._finishSet={},a=0;a<this._callbackSet.length;++a)this._callbackSet[a].callback();this._callbackSet.length=0,this._out&&this._out.disconnect(),this._atop=e(),this._out=this._atop.ac.createGain(),this._out.gain.value=this._timbre.gain,this._out.connect(this._atop.out)},a.prototype.now=function(){return null!=this._now?this._now:(this._startPollTimer(!0),this._now=g(),this._now)},a.prototype.on=function(a,b){this._handlers.hasOwnProperty(a)||(this._handlers[a]=[]),this._handlers[a].push(b)},a.prototype.off=function(a,b){if(this._handlers.hasOwnProperty(a))if(b){var c,d=this._handlers[a];for(c=0;c<d.length;++c)d[c]===b&&(d.splice(c,1),c-=1)}else this._handlers[a]=[]},a.prototype._trigger=function(a,b){var c,d=this._handlers[a];if(d)for(c=0;c<d.length;++c)d[c](b)},a.prototype._makeSound=function(a){var b,c,d,e,f=a.timbre||this._timbre,g=a.time,h=g+a.duration,i=Math.min(h,g+f.attack),j=i,k=h+f.release,l=f.detune&&1!=f.detune,m=f.gain*a.velocity*(l?.5:1),n=this._atop.ac;if(a.duration>0&&a.velocity>0){for(b=n.createGain(),b.gain.setValueAtTime(0,g),b.gain.linearRampToValueAtTime(m,i);i+1/32>j&&h>j+1/256;)j+=1/256,b.gain.linearRampToValueAtTime(m*(f.sustain+(1-f.sustain)*Math.exp((i-j)/f.decay)),j);b.gain.setTargetAtTime(m*f.sustain,j,f.decay),b.gain.setValueAtTime(m*(f.sustain+(1-f.sustain)*Math.exp((i-h)/f.decay)),h),b.gain.linearRampToValueAtTime(0,k),b.connect(this._out),!f.cutoff&&!f.cutfollow||1/0==f.cutoff?c=b:(c=n.createBiquadFilter(),c.frequency.value=f.cutoff+(a.frequency-f.cutoff)*f.cutfollow,c.Q.value=f.resonance,c.connect(b)),d=n.createOscillator();try{d.type=f.wave}catch(o){d.type="square"}d.frequency.value=a.frequency,d.connect(c),d.start(g),d.stop(k),l&&(e=n.createOscillator(),e.type=f.wave,e.frequency.value=a.frequency*f.detune,e.connect(c),e.start(g),e.stop(k)),a.gainNode=b,a.oscillators=[d],l&&a.oscillators.push(e),a.cleanuptime=k}else a.duration=0;this._startSet.push(a)},a.prototype._truncateSound=function(b,c){if(c<b.time+b.duration&&(b.duration=Math.max(0,c-b.time),b.gainNode)){var d,e=b.timbre||this._timbre,f=b.time,g=Math.min(c,f+e.attack),h=c+e.release,i=h+a.cleanupDelay,j=e.detune&&1!=e.detune,k=e.gain*b.velocity*(j?.5:1),l=b.gainNode;if(l.gain.cancelScheduledValues(c),f>=c?l.gain.setValueAtTime(0,c):g>=c?l.gain.linearRampToValueAtTime(k*(c-f)/(g-f)):l.gain.setValueAtTime(k*(e.sustain+(1-e.sustain)*Math.exp((g-c)/e.decay)),c),l.gain.linearRampToValueAtTime(0,h),b.oscillators)for(d=0;d<b.oscillators.length;++d)b.oscillators[d].stop(h);b.cleanuptime=i}},a.prototype._doPoll=function(){if(this._pollTimer=null,this._now=null,h)return void this.silence();var b,c,d,e,f,g,i,j=this._atop.ac.currentTime;if(this._minQueueTime-j<=a.bufferSecs){for(this._unsortedQueue&&(this._queue.sort(function(a,b){return a.time!=b.time?a.time-b.time:a.duration!=b.duration?a.duration-b.duration:a.frequency-b.frequency}),this._unsortedQueue=!1),b=0;b<this._queue.length&&!(this._queue[b].time-j>a.bufferSecs);++b);if(b>0){for(c=this._queue.splice(0,b),b=0;b<c.length;++b)this._makeSound(c[b]);this._minQueueTime=this._queue.length>0?this._queue[0].time:1/0}}for(b=0;b<this._cleanupSet.length;++b)f=this._cleanupSet[b],f.cleanuptime<j&&(f.gainNode&&(f.gainNode.disconnect(),f.gainNode=null),this._cleanupSet.splice(b,1),b-=1);for(e in this._finishSet)this._finishSet.hasOwnProperty(e)&&(f=this._finishSet[e],d=f.time+f.duration,j>=d&&(this._trigger("noteoff",f),1/0!=f.cleanuptime&&this._cleanupSet.push(f),delete this._finishSet[e]));for(b=0;b<this._callbackSet.length;++b)this._callbackSet[b].time<=j&&(this._callbackSet[b].callback(),this._callbackSet.splice(b,1),b-=1);for(b=0;b<this._startSet.length;++b)this._startSet[b].time<=j&&(i=f=this._startSet[b],e=f.frequency,g=null,this._finishSet.hasOwnProperty(e)&&(g=this._finishSet[e],g.time<f.time||g.time==f.time&&g.duration<f.duration?(this._truncateSound(g,f.time),this._trigger("noteoff",g),delete this._finishSet[e]):(this._truncateSound(f,g.time),g=f)),this._startSet.splice(b,1),b-=1,f.duration>0&&f.velocity>0&&g!==f&&(this._finishSet[e]=f,this._trigger("noteon",f)));this._startPollTimer()},a.prototype._startPollTimer=function(a){var b,c,d=this,e=1/0;if(this._pollTimer){if(null!=this._now)return;clearTimeout(this._pollTimer),this._pollTimer=null}if(a)e=0;else{for(b=0;b<this._startSet.length;++b)e=Math.min(e,this._startSet[b].time);for(b in this._finishSet)this._finishSet.hasOwnProperty(b)&&(e=Math.min(e,this._finishSet[b].time+this._finishSet[b].duration));for(b=0;b<this._callbackSet.length;++b)e=Math.min(e,this._callbackSet[b].time);this._cleanupSet.length>0&&(e=Math.min(e,this._cleanupSet[0].cleanuptime+1)),e=Math.min(e,this._minQueueTime-1)}c=Math.max(0,e-this._atop.ac.currentTime),isNaN(c)||1/0!=c&&(this._pollTimer=setTimeout(function(){d._doPoll()},Math.round(1e3*c)))},a.prototype.tone=function(b,c,d,e,f){if(!this._atop)return{release:function(){}};var g,h;b||(b="C"),isNaN(b)?(g=v(b),h=t(g)):(h=Number(b),0>h?(g=-h,h=t(g)):g=u(h));var i=(this._atop.ac,this.now()),j=i+(e||0),k={time:j,on:!1,frequency:h,midi:g,velocity:null==c?1:c,duration:null==d?a.toneLength:d,timbre:f,instrument:this,gainNode:null,oscillators:null,cleanuptime:1/0};j<i+a.bufferSecs?this._makeSound(k):(!this._unsortedQueue&&this._queue.length&&j<this._queue[this._queue.length-1].time&&(this._unsortedQueue=!0),this._queue.push(k),this._minQueueTime=Math.min(this._minQueueTime,k.time))},a.prototype.schedule=function(a,b){this._callbackSet.push({time:this.now()+a,callback:b})},a.prototype.play=function(){var a,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r=Array.prototype.slice.call(arguments),s=null,t={},u=0,v=[];if(r.length&&"function"==typeof r[r.length-1]&&(s=r.pop()),!this._atop)return void(s&&s());if(e=0,"object"==typeof r[0]){for(g in r[0])r[0].hasOwnProperty(g)&&(t[g]=r[0][g]);e=1}for(;e<r.length;++e)for(a=r[e].split(/\n(?=X:)/),g=0;g<a.length;++g)d=c(a[g]),d&&(!t.tempo&&d.tempo&&(t.tempo=d.tempo,d.unitbeat&&(t.tempo*=d.unitbeat/(d.unitnote||1))),d.voice&&v.push(d));for(t.tempo||(t.tempo=120),p=60/t.tempo,g=0;g<v.length;++g){d=v[g];for(l in d.voice)if(d.voice.hasOwnProperty(l)){if(f=b(t.timbre||d.voice[l].timbre||d.timbre||this._timbre),j=d.voice[l].stems,!j)continue;for(h=0,k=0;k<j.length;++k){for(n=j[k],i=1/Math.sqrt(n.note.length),m=0;m<n.note.length;++m)o=n.note[m],o.holdover||(q=(o.time||n.time)*p,n.staccato&&(q=Math.min(Math.min(q,p/16),f.attack+f.decay)),this.tone(o.pitch,o.velocity||i,q,h,f));h+=n.time*p}u=Math.max(h,u)}}this._maxScheduledTime=Math.max(this._maxScheduledTime,this.now()+u),s&&this.schedule(u,s)};var A=y("wave:square;gain:1;attack:0.001;decay:0.4;sustain:0;release:0.1;cutoff:0;cutfollow:0,resonance:0;detune:0"),B=/^([A-Za-z]):\s*(.*)$/,C=/(?:^\[V:[^\]\s]*\])|\s+|%[^\n]*|![^!]*!|\[|\]|>+|<+|(?:(?:\^\^|\^|__|_|=|)[A-Ga-g](?:,+|'+|))|\d*\/\d+|\d+\/?|\/+|[xzXZ]|./g;return a}(),m={Instrument:l};if(b&&b.exports)b.exports=m;else if(c&&c.amd)c(function(){return m});else for(var n in m)m.hasOwnProperty(n)&&(a[n]=m[n])}(this,"object"==typeof module&&module,"function"==typeof define&&define);